!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.AutoSuggest=t()}(this,function(){"use strict";function e(e){return[].concat(e).map(function(e){var t=void 0===e?"undefined":r(e);if("string"===t)e={on:[e],show:e,insertText:e,focusText:[0,0]};else if("object"===t){try{u("Suggestion",e,"value")}catch(t){u("Suggestion",e,["on","show"]),c("Suggestion",e,["insertHtml","insertText"])}f("Suggestion",e,"on","string"),f("Suggestion",e,"show","string"),f("Suggestion",e,"value","string"),f("Suggestion",e,"insertText","string"),f("Suggestion",e,"insertHtml","string"),e.show=e.show||e.value,e.insertText=e.insertText||e.value,e.on=[e.show].concat(e.on||e.value),e.focusText=e.focusText||[0,0],e.focusText.constructor!==Array&&(f("Suggestion",e,"focusText","number"),e.focusText=[e.focusText,e.focusText]),e.insertHtml&&(e.focusHtml=e.focusHtml||[0,0],e.focusHtml.constructor!==Array&&(f("Suggestion",e,"focusHtml","number"),e.focusHtml=[e.focusHtml,e.focusHtml]))}return e})}function t(e){return e.replace(/[.?+*^$[{()|\\]/g,"\\$&")}function n(n){var o=this;if(n&&!n.values&&(n={values:n}),u("SuggestionList",n,"values"),f("Suggestion",n,"trigger","string"),n.caseSensitive=!!n.caseSensitive,"function"==typeof n.values?this.getSuggestions=function(t,o){n.values.call(this,t,function(t){return o(e(t))})}:n.values.constructor!==Array&&"string"!=typeof n.values||(n.values=e(n.values),this.getSuggestions=function(e,i){var r=n.caseSensitive?"":"i",s="^"+(o.trigger?"(?:"+t(o.trigger)+")?":"")+t(e),a=RegExp(s,r),d=RegExp(s+"$",r);i(n.values.filter(function(e){return e.on.some(function(e){return a.test(e)&&!d.test(e)})}))}),this.trigger=n.trigger,this.trigger){var i=t(this.trigger);this.regex=RegExp("(?:\\W+|^)"+i+"(\\S*)$")}else this.regex=RegExp("(?:^|\\s+)(\\S+)$")}function o(e,t,n){var o=e.slice(0,t),i=o.split(n||/\W/).pop(),r=i.length?o.slice(0,0-i.length):o;return i+=e.slice(t),{textAfterTrigger:i,textUptoTrigger:r}}function i(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return Math.max.apply(Math,l(t.map(function(e){return parseFloat(p(e,"line-height"))})))}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=function(){function e(e,t){for(var n=0;t.length>n;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),d=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],o=!0,i=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);o=!0);}catch(e){i=!0,r=e}finally{try{!o&&a.return&&a.return()}finally{if(i)throw r}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);e.length>t;t++)n[t]=e[t];return n}return Array.from(e)},u=function(e,t,n){[].concat(n).forEach(function(n){if(void 0===t[n])throw Error("AutoSuggest: Missing required parameter, "+e+"."+n)})},c=function(e,t,n){var o=void 0;if(!n.some(function(e){return void 0!==t[o=e]}))throw Error("AutoSuggest: Missing required parameter, "+e+"."+o)},f=function(e,t,n,o){[].concat(t[n]).forEach(function(t){var i=void 0===t?"undefined":r(t);if(i!==o&&"undefined"!==i)throw new TypeError("AutoSuggest: Invalid Type for "+e+"."+n+", expected "+o)})},p=function(e,t){return window.getComputedStyle(e).getPropertyValue(t)},g=function(e){var t=e,n=0,o=0;do{o+=t.offsetLeft,n+=t.offsetTop}while(t=t.offsetParent);return{left:o,top:n}},h=function(e){if(e.createTextRange){var t=e.createTextRange(),n=window.getComputedStyle(e),o=parseFloat(n.paddingLeft),i=t.getBoundingClientRect();return e.getBoundingClientRect().left+e.clientLeft+o-i.left}return e.scrollLeft},v=function(e){return[e.selectionStart,e.selectionEnd].sort(function(e,t){return e-t})},y=function(){var e=window.getSelection(),t=e.getRangeAt(0),n=t.startContainer,o=t.startOffset,i=t.endContainer,r=t.endOffset,s=e.anchorNode===n&&e.anchorOffset===o;return n.nodeType!==n.TEXT_NODE&&(n=n.childNodes[o-1])&&(o=(n=S(n)).nodeValue?n.nodeValue.length:0),i.nodeType!==i.TEXT_NODE&&(i=i.childNodes[r])&&(i=x(i),r=0),{startContainer:n,startOffset:o,endContainer:i,endOffset:r,direction:s}},m=function(){var e=0,t=[];return function(n,o){for(t[o-e]=n;t[0];)++e,t.shift()()}},w=function(e,t,n){if(t="autosuggest_"+t,void 0===n)return void 0!==(n=e.dataset[t])?JSON.parse(e.dataset[t]):n;e.dataset[t]=JSON.stringify(n)},x=function(e){for(var t=e;t.firstChild;)t=t.firstChild;return t},S=function(e){for(var t=e;t.lastChild;)t=t.lastChild;return t},C=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize","whiteSpace","wordWrap","wordBreak"];n.prototype.getMatch=function(e){return e.match(this.regex)[1]};var T=function(){function e(){s(this,e),this.width=0,this.isEmpty=!0,this.isActive=!1,this.dropdownContent=document.createElement("ul"),this.dropdownContent.className="dropdown-menu dropdown-menu-left",this.dropdown=document.createElement("div"),this.dropdown.className="dropdown open",this.dropdown.style.position="absolute",this.hide(),this.dropdown.appendChild(this.dropdownContent),document.body.appendChild(this.dropdown)}return a(e,[{key:"show",value:function(e){e&&(this.dropdown.style.left=e.left+"px",this.dropdown.style.top=e.top+"px",e.left+this.width>document.body.offsetWidth?(this.dropdownContent.classList.remove("dropdown-menu-left"),this.dropdownContent.classList.add("dropdown-menu-right")):(this.dropdownContent.classList.remove("dropdown-menu-right"),this.dropdownContent.classList.add("dropdown-menu-left"))),this.dropdown.style.display="block",this.isActive=!0}},{key:"hide",value:function(){this.dropdown.style.display="none",this.isActive=!1}},{key:"empty",value:function(){this.dropdownContent.innerHTML="",this.isEmpty=!0}},{key:"fill",value:function(e,t){var n=this;this.empty(),e.forEach(function(e){var o=function(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}("<li><a>"+e.show+"</a></li>");n.dropdownContent.appendChild(o),w(o,"suggestion",e),o.addEventListener("mouseenter",function(){n.getActive().classList.remove("active"),o.classList.add("active")}),o.addEventListener("mousedown",function(o){t(e),n.hide(),o.preventDefault(),o.stopPropagation()})}),this.isActive||this.show(),this.width=this.dropdownContent.offsetWidth,this.isActive||this.hide(),this.setActive(),this.isEmpty=!1}},{key:"showLoader",value:function(e){this.empty(),this.dropdownContent.innerHTML='<div class="autosuggest-loader">Loading...</div>',this.show(e),this.isActive=!1}},{key:"getActive",value:function(){for(var e=Array.prototype.slice.call(this.dropdownContent.querySelectorAll("li.active"),0);e[1];)e.pop().classList.remove("active");return e[0]}},{key:"getValue",value:function(e){return w(e||this.getActive(),"suggestion")}},{key:"setActive",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.dropdownContent.firstElementChild,t=arguments[1];t&&t.classList.remove("active"),e.classList.add("active")}},{key:"selectNext",value:function(){var e=this.getActive();this.setActive(e.nextElementSibling||this.dropdownContent.firstElementChild,e)}},{key:"selectPrev",value:function(){var e=this.getActive();this.setActive(e.previousElementSibling||this.dropdownContent.lastElementChild,e)}}]),e}(),E="\ufeff",A=function(e,t){var n=void 0;if(e.nextSibling)n=e.nextSibling;else{for(n=e.parentNode;n&&n!==t&&!n.nextSibling;)n=n.parentNode;if(!n||n===t)return;n=n.nextSibling}return x(n)},b=function(e){var t=e.element,n=e.trigger,o=e.suggestion,i=e.onChange;if(w(t,"isInput")){var r=v(t),s=d(r,2),a=s[1],u=t.value,c=u.slice(0,s[0]),f=c.split(n||/\W/).pop();c=c.slice(0,0-f.length-(n||"").length)+(o.insertText||o.insertHtml),t.value=c+u.slice(a),t.focus();var p=o.insertText?o.focusText:[0,0],g=c.length;t.setSelectionRange(g+p[0],g+p[1])}else{var h=y(),m=h.startContainer,x=h.startOffset,S=h.endContainer,C=h.endOffset,T=window.getSelection(),E=document.createRange(),b=m.nodeValue.slice(0,x),L=b.split(n||/\W/).pop();if(b=b.slice(0,0-L.length-(n||"").length),m!==S)m.nodeValue=b,function(e,t){if(e!==t)for(var n=A(e);n!==t;)n.parentNode.removeChild(n),n=A(e)}(m,S),S.nodeValue&&(S.nodeValue=S.nodeValue.slice(C));else{var N=m.nodeValue.slice(C);if(N){var H=document.createTextNode(N);m.parentNode.insertBefore(H,m.nextSibling)}m.nodeValue=b}if(o.insertHtml){var k=function e(t,n,o){var i=void 0,r=t;if(0!==r){do{r+=(i=n.pop()).textContent.length}while(n.length&&0>r);if(!i)throw new TypeError("AutoSuggest: Invalid value provided for Suggestion.focusHtml")}0===r?E[o+"After"](n[n.length-1]||m):i.nodeType===i.TEXT_NODE?E[o](i,r):e(r-i.textContent.length,Array.prototype.slice.call(i.childNodes,0),o)},O=function(e,t){var n=document.createElement("div");n.innerHTML=t;for(var o=e.nextSibling,i=[];n.firstChild;)i.push(n.firstChild),e.parentNode.insertBefore(n.firstChild,o);return i}(m,o.insertHtml),V=O.length?o.focusHtml:[0,0];k(V[1],[].concat(l(O)),"setEnd"),k(V[0],[].concat(l(O)),"setStart")}else{m.nodeValue+=o.insertText;var R=o.focusText,W=m.nodeValue.length;E.setStart(m,W+R[0]),E.setEnd(m,W+R[1])}T.removeAllRanges(),T.addRange(E)}i(o)};return function(){function e(t){if(s(this,e),!t)throw Error("AutoSuggest: Missing required parameter, options");this.inputs=[],this.dropdown=new T,this.onChange=t.onChange||Function.prototype,this.maxSuggestions=t.maxSuggestions||10,this.suggestionLists=t.suggestions||[];for(var r=0;this.suggestionLists.length>r;r++){var a=this.suggestionLists[r];a instanceof n||(a.constructor!==Object&&(a={values:a}),!a.hasOwnProperty("caseSensitive")&&t.hasOwnProperty("caseSensitive")&&(a.caseSensitive=t.caseSensitive),this.suggestionLists[r]=new n(a))}var l=this,u=null,c=!1;this.onBlurHandler=function(){l.dropdown.hide()},this.onKeyDownHandler=function(e){if(l.dropdown.isActive){var t=function(){e.preventDefault(),c=!0};if(13===e.keyCode||9===e.keyCode)return b({element:this,trigger:u.trigger,suggestion:l.dropdown.getValue(),onChange:l.onChange.bind(this)}),l.dropdown.hide(),t();if(40===e.keyCode)return l.dropdown.selectNext(),t();if(38===e.keyCode)return l.dropdown.selectPrev(),t();if(27===e.keyCode)return l.dropdown.hide(),t()}};var f=0;this.onKeyUpHandler=function(e){var t=this;if(c)c=!1;else{var n=void 0;if(w(this,"isInput")){var r=v(this),s=d(r,2),a=s[0];if(/\w/.test(this.value.charAt(s[1])||" "))return void l.dropdown.hide();n=this.value.slice(0,a)}else{var p=y(),x=p.startContainer,S=p.startOffset,T=p.endContainer;if(!x||!T||!x.nodeValue||/\w/.test((T.nodeValue||"").charAt(p.endOffset)||" "))return void l.dropdown.hide();n=x.nodeValue.slice(0,S)}f++,l.dropdown.empty();var A=m(),L=0,N=void 0,H=!1;l.suggestionLists.forEach(function(e){e.regex.test(n)&&(H=!0,function(r,s){var a=e.getMatch(n),c=function(e,t){if(w(e,"isInput")){var n=v(e),r=d(n,1)[0],s=o(e.value,r,t),a=s.textAfterTrigger,l=s.textUptoTrigger,u=document.createElement("pre");u.id="autosuggest-positionclone";var c=document.createElement("span");c.appendChild(document.createTextNode(E));var f=window.getComputedStyle(e);C.forEach(function(e){u.style[e]=f[e]});var p=g(e);u.style.opacity=0,u.style.position="absolute",u.style.top=p.top+"px",u.style.left=p.left+"px",document.body.appendChild(u),e.scrollHeight>parseInt(f.height)?u.style.overflowY="scroll":u.style.overflow="hidden";var m=void 0;"INPUT"===e.tagName?(u.appendChild(document.createTextNode(l.replace(/ /g," "))),u.appendChild(c),u.appendChild(document.createTextNode(a.replace(/ /g," "))),u.style.overflowX="auto",u.style.whiteSpace="nowrap",u.scrollLeft=r===e.value.length?u.scrollWidth-u.clientWidth:Math.min(h(e),u.scrollWidth-u.clientWidth),m=u.offsetHeight-parseFloat(f.paddingTop)-parseFloat(f.paddingBottom)):(u.appendChild(document.createTextNode(l)),u.appendChild(c),u.appendChild(document.createTextNode(a)),u.style.maxWidth="100%",u.scrollTop=e.scrollTop,u.scrollLeft=e.scrollLeft,m=i(u,c));var x=g(c),S=g(e);x.top+=m-u.scrollTop,x.left-=u.scrollLeft;var T=x.left-S.left;return(0>T||T>e.clientWidth)&&(x.left=S.left),document.body.removeChild(u),x}var A=window.getSelection().getRangeAt(0),b=A.startContainer,L=A.startOffset,N=A.endContainer,H=A.endOffset,k=y(),O=k.startContainer,V=k.direction,R=o(O.nodeValue,k.startOffset,t),W=R.textAfterTrigger,I=R.textUptoTrigger,B=O.parentNode,M=O.nextSibling,P=document.createElement("span");if(P.appendChild(document.createTextNode(E)),B.insertBefore(P,M),W){O.nodeValue=I;var U=document.createTextNode(W);B.insertBefore(U,M)}var D=g(P),K=i(P);D.top+=K,B.removeChild(P),W&&(B.removeChild(O.nextSibling),O.nodeValue=I+W);var j=window.getSelection();if(j.setBaseAndExtent)V?j.setBaseAndExtent(b,L,N,H):j.setBaseAndExtent(N,H,b,L);else{var z=document.createRange();z.setStart(b,L),z.setEnd(N,H),j.removeAllRanges(),j.addRange(z)}return D}(t,e.trigger);l.dropdown.isEmpty&&(N&&clearTimeout(N),N=setTimeout(function(){l.dropdown.showLoader(c)},0)),e.getSuggestions.call(t,a,function(n){s===f&&A(function(){N&&clearTimeout(N),l.dropdown.isEmpty&&(n.length?(u=e,l.dropdown.fill(n.slice(0,l.maxSuggestions),function(n){b({element:t,trigger:e.trigger,suggestion:n,onChange:l.onChange.bind(t)})}),l.dropdown.show(c)):l.dropdown.hide())},r)})}(L++,f))}),H||l.dropdown.hide()}};for(var p=arguments.length,x=Array(p>1?p-1:0),S=1;p>S;S++)x[S-1]=arguments[S];this.addInputs.apply(this,x)}return a(e,[{key:"addInputs",value:function(){for(var e=this,t=arguments.length,n=Array(t),o=0;t>o;o++)n[o]=arguments[o];Array.prototype.concat.apply([],n.map(function(e){return e[0]?Array.prototype.slice.call(e,0):e})).forEach(function(t){if("TEXTAREA"===t.tagName||"INPUT"===t.tagName&&"text"===t.type)w(t,"isInput",!0);else{if(!t.isContentEditable)throw Error("AutoSuggest: Invalid input: only input[type = text], textarea and contenteditable elements are supported");w(t,"isInput",!1)}t.addEventListener("blur",e.onBlurHandler),t.addEventListener("keyup",e.onKeyUpHandler),t.addEventListener("mouseup",e.onKeyUpHandler),t.addEventListener("keydown",e.onKeyDownHandler,!0),w(t,"index",e.inputs.push(t)-1)})}},{key:"removeInputs",value:function(){for(var e=this,t=arguments.length,n=Array(t),o=0;t>o;o++)n[o]=arguments[o];Array.prototype.concat.apply([],n.map(function(e){return e[0]?Array.prototype.slice.call(e,0):e})).forEach(function(t){var n=w(t,"index");isNaN(n)||(e.inputs.splice(n,1),t.removeEventListener("blur",e.onBlurHandler),t.removeEventListener("keyup",e.onKeyUpHandler),t.removeEventListener("mouseup",e.onKeyUpHandler),t.removeEventListener("keydown",e.onKeyDownHandler,!0))})}},{key:"destroy",value:function(){this.removeInputs(this.inputs)}}]),e}()});
